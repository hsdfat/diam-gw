# Diameter Gateway Configuration Example
# This file demonstrates all available configuration options
# Copy to config.yaml and customize for your environment

# Gateway Identity Configuration
gateway:
  origin_host: gateway.example.com
  origin_realm: example.com
  vendor_id: 10415  # 3GPP
  product_name: DiameterGateway
  firmware_version: 1

# Inbound Server Configuration (Logic Apps connect here)
server:
  listen_addr: 0.0.0.0:3868
  max_connections: 1000

  # Timeouts
  handshake_timeout: 10s
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 300s

  # Watchdog (DWR/DWA) settings
  watchdog_interval: 30s
  watchdog_timeout: 10s
  watchdog_retries: 3

  # Buffer sizes
  read_buffer_size: 8192
  write_buffer_size: 8192

# Outbound Client Configuration (Gateway to DRAs)
client:
  connect_timeout: 5s
  request_timeout: 10s
  retry_attempts: 3
  retry_delay: 100ms

  # Connection pool settings
  max_idle_conns: 10
  max_conns_per_host: 100
  idle_conn_timeout: 90s

  # Watchdog settings
  watchdog_interval: 30s
  watchdog_timeout: 10s

# DRA (Diameter Routing Agent) Configuration
dras:
  # Primary DRA (highest priority)
  - name: dra-primary
    host: dra1.example.com
    port: 3868
    priority: 100  # Lower = higher priority
    weight: 100    # For load balancing
    enabled: true

    # Optional: Specific destination for this DRA
    destination_host: dra1.example.com
    destination_realm: example.com

    # Health check settings
    health_check_interval: 10s
    health_check_timeout: 5s

    # Failover settings
    max_failures: 3
    failure_window: 1m
    recovery_interval: 30s

  # Secondary DRA (backup)
  - name: dra-secondary
    host: dra2.example.com
    port: 3868
    priority: 200  # Lower priority than primary
    weight: 100
    enabled: true
    health_check_interval: 10s
    health_check_timeout: 5s
    max_failures: 3
    failure_window: 1m
    recovery_interval: 30s

# Logging Configuration
logging:
  # Level: debug, info, warn, error
  level: info
  # Format: json, text
  format: json

  # Message logging for debugging (disabled in production)
  log_messages: false
  log_message_max_len: 1024

# Metrics Configuration
metrics:
  enabled: true
  port: 9091
  path: /metrics

# ---
# Example Deployment Scenarios
# ---

# Scenario 1: Single DRA (Simple Setup)
# Uncomment and modify:
#
# dras:
#   - name: single-dra
#     host: dra.example.com
#     port: 3868
#     priority: 100
#     enabled: true

# Scenario 2: Active-Standby (High Availability)
# Primary handles all traffic, secondary is backup
# Uncomment and modify:
#
# dras:
#   - name: primary-dra
#     host: dra-primary.example.com
#     port: 3868
#     priority: 100  # High priority
#     weight: 100
#     enabled: true
#     max_failures: 3
#     recovery_interval: 30s
#
#   - name: standby-dra
#     host: dra-standby.example.com
#     port: 3868
#     priority: 200  # Lower priority (backup)
#     weight: 100
#     enabled: true

# Scenario 3: Active-Active Load Balancing
# Traffic distributed across multiple DRAs
# Uncomment and modify:
#
# dras:
#   - name: dra-1
#     host: dra1.example.com
#     port: 3868
#     priority: 100  # Same priority
#     weight: 100    # Equal weight
#     enabled: true
#
#   - name: dra-2
#     host: dra2.example.com
#     port: 3868
#     priority: 100  # Same priority
#     weight: 100    # Equal weight
#     enabled: true
#
#   - name: dra-3
#     host: dra3.example.com
#     port: 3868
#     priority: 100  # Same priority
#     weight: 50     # Half the traffic of others
#     enabled: true

# Scenario 4: Geo-Distributed with Priorities
# Prefer local DRA, failover to remote site
# Uncomment and modify:
#
# dras:
#   # Local site (US-EAST)
#   - name: us-east-dra-1
#     host: dra-us-east-1.example.com
#     port: 3868
#     priority: 100  # Highest priority
#     weight: 100
#     enabled: true
#
#   - name: us-east-dra-2
#     host: dra-us-east-2.example.com
#     port: 3868
#     priority: 100  # Same priority as above
#     weight: 100
#     enabled: true
#
#   # Remote site (US-WEST, backup)
#   - name: us-west-dra-1
#     host: dra-us-west-1.example.com
#     port: 3868
#     priority: 200  # Lower priority (failover)
#     weight: 100
#     enabled: true
#
#   - name: us-west-dra-2
#     host: dra-us-west-2.example.com
#     port: 3868
#     priority: 200  # Lower priority (failover)
#     weight: 100
#     enabled: true

# Scenario 5: Production with Monitoring and Debug
# Uncomment for troubleshooting:
#
# logging:
#   level: debug
#   format: json
#   log_messages: true  # Log full diameter messages
#   log_message_max_len: 4096
#
# metrics:
#   enabled: true
#   port: 9091
#
# server:
#   watchdog_interval: 10s  # More frequent health checks
#
# client:
#   request_timeout: 30s    # Longer timeout for debugging

# Environment Variable Overrides
# You can override any setting using environment variables:
#
# DIAMGW_GATEWAY_ORIGIN_HOST=gateway.prod.example.com
# DIAMGW_GATEWAY_ORIGIN_REALM=prod.example.com
# DIAMGW_SERVER_LISTEN_ADDR=0.0.0.0:3868
# DIAMGW_LOGGING_LEVEL=debug
# DIAMGW_METRICS_PORT=9091
